// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id           String         @id @default(uuid())
  username     String         @unique
  email        String         @unique
  password     String
  SessionToken SessionToken[]

  FriendA Friends[] @relation("friendA")
  FriendB Friends[] @relation("friendB")

  FriendRequest    FriendRequest[] @relation("FromRequest")
  MyFriendRequests FriendRequest[] @relation("MyFriendRequests")

  MyGroups   Group[]   @relation("groups")
  MyMessages Message[] @relation("messageOwner")
}

model Friends {
  friendA         User   @relation("friendA", fields: [friendAUsername], references: [username])
  friendAUsername String

  friendB         User   @relation("friendB", fields: [friendBUsername], references: [username])
  friendBUsername String

  @@id([friendAUsername, friendBUsername])
}

model SessionToken {
  owner   User   @relation(fields: [ownerID], references: [id])
  ownerID String @id
  token   String @unique
}

model FriendRequest {
  id String @id @default(uuid())

  from   User   @relation("MyFriendRequests", fields: [fromID], references: [username])
  fromID String

  to   User   @relation("FromRequest", fields: [toID], references: [username])
  toID String
}

model Group {
  id    String @id @default(uuid())
  name  String @unique
  users User[] @relation("groups")

  Channels Channel[] @relation("channels")

}

model Channel {
  id          String @id @default(uuid())
  channelName String @unique
  Group       Group  @relation("channels", fields: [groupID], references: [id])
  groupID     String

  Messages Message[] @relation("messages")
}

model Message {
  id      String @id @default(uuid())
  content String

  Channel   Channel @relation("messages", fields: [channelID], references: [id])
  channelID String

  Owner         User   @relation("messageOwner", fields: [ownerUsername], references: [username])
  ownerUsername String

  date DateTime @default(now())
}
